
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../baseline/">
      
      
        <link rel="next" href="../risk_aversion/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>main_recipe - dscim Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="CILlight" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dscim.menu.main_recipe.MainRecipe" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="dscim Documentation" class="md-header__button md-logo" aria-label="dscim Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dscim Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              main_recipe
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="CILlight" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/climateimpactlab/dscim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="dscim Documentation" class="md-nav__button md-logo" aria-label="dscim Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    dscim Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/climateimpactlab/dscim" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    dscim.menu
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            dscim.menu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../baseline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    baseline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    main_recipe
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    main_recipe
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe" class="md-nav__link">
    <span class="md-ellipsis">
      MainRecipe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MainRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_cc" class="md-nav__link">
    <span class="md-ellipsis">
      ce_cc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_fair_no_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      ce_fair_no_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_fair_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      ce_fair_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_no_cc" class="md-nav__link">
    <span class="md-ellipsis">
      ce_no_cc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_coefficients" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_coefficients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_fit" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.gmsl_max" class="md-nav__link">
    <span class="md-ellipsis">
      gmsl_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.median_params_marginal_damages" class="md-nav__link">
    <span class="md-ellipsis">
      median_params_marginal_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.output_attrs" class="md-nav__link">
    <span class="md-ellipsis">
      output_attrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculate_discount_factors" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_discount_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculate_scc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_scc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculate_stream_discount_factors" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_stream_discount_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculated_damages" class="md-nav__link">
    <span class="md-ellipsis">
      calculated_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce" class="md-nav__link">
    <span class="md-ellipsis">
      ce
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_cc_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      ce_cc_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_no_cc_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      ce_no_cc_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.collapsed_pop" class="md-nav__link">
    <span class="md-ellipsis">
      collapsed_pop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_points" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.discounted_damages" class="md-nav__link">
    <span class="md-ellipsis">
      discounted_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.full_uncertainty_iqr" class="md-nav__link">
    <span class="md-ellipsis">
      full_uncertainty_iqr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_no_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_no_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_per_capita" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_per_capita
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_damages_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      global_damages_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.marginal_damages" class="md-nav__link">
    <span class="md-ellipsis">
      marginal_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.order_plate" class="md-nav__link">
    <span class="md-ellipsis">
      order_plate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.order_scc" class="md-nav__link">
    <span class="md-ellipsis">
      order_scc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.stat_uncertainty_iqr" class="md-nav__link">
    <span class="md-ellipsis">
      stat_uncertainty_iqr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.uncollapsed_sccs" class="md-nav__link">
    <span class="md-ellipsis">
      uncollapsed_sccs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.weitzman_min" class="md-nav__link">
    <span class="md-ellipsis">
      weitzman_min
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../risk_aversion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    risk_aversion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../equity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    equity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simple_storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simple_storage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    decorators
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    dscim.preprocessing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            dscim.preprocessing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/input_damages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    input_damages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/midprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    midprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/preprocessing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    preprocessing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    dscim.utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            dscim.utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/menu_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    menu_runs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/rff/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rff
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe" class="md-nav__link">
    <span class="md-ellipsis">
      MainRecipe
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MainRecipe">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_cc" class="md-nav__link">
    <span class="md-ellipsis">
      ce_cc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_fair_no_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      ce_fair_no_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_fair_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      ce_fair_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_no_cc" class="md-nav__link">
    <span class="md-ellipsis">
      ce_no_cc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_coefficients" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_coefficients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_fit" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_fit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.gmsl_max" class="md-nav__link">
    <span class="md-ellipsis">
      gmsl_max
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.median_params_marginal_damages" class="md-nav__link">
    <span class="md-ellipsis">
      median_params_marginal_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.output_attrs" class="md-nav__link">
    <span class="md-ellipsis">
      output_attrs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculate_discount_factors" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_discount_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculate_scc" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_scc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculate_stream_discount_factors" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_stream_discount_factors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.calculated_damages" class="md-nav__link">
    <span class="md-ellipsis">
      calculated_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce" class="md-nav__link">
    <span class="md-ellipsis">
      ce
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_cc_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      ce_cc_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.ce_no_cc_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      ce_no_cc_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.collapsed_pop" class="md-nav__link">
    <span class="md-ellipsis">
      collapsed_pop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.damage_function_points" class="md-nav__link">
    <span class="md-ellipsis">
      damage_function_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.discounted_damages" class="md-nav__link">
    <span class="md-ellipsis">
      discounted_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.full_uncertainty_iqr" class="md-nav__link">
    <span class="md-ellipsis">
      full_uncertainty_iqr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_no_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_no_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_per_capita" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_per_capita
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_consumption_pulse" class="md-nav__link">
    <span class="md-ellipsis">
      global_consumption_pulse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.global_damages_calculation" class="md-nav__link">
    <span class="md-ellipsis">
      global_damages_calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.marginal_damages" class="md-nav__link">
    <span class="md-ellipsis">
      marginal_damages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.order_plate" class="md-nav__link">
    <span class="md-ellipsis">
      order_plate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.order_scc" class="md-nav__link">
    <span class="md-ellipsis">
      order_scc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.stat_uncertainty_iqr" class="md-nav__link">
    <span class="md-ellipsis">
      stat_uncertainty_iqr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.uncollapsed_sccs" class="md-nav__link">
    <span class="md-ellipsis">
      uncollapsed_sccs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dscim.menu.main_recipe.MainRecipe.weitzman_min" class="md-nav__link">
    <span class="md-ellipsis">
      weitzman_min
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>main_recipe</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










<p><span class="doc-section-title">Classes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe" href="#dscim.menu.main_recipe.MainRecipe">MainRecipe</a></code></td>
            <td>
              <div class="doc-md-description">
                <p>Main class for DSCIM execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>







  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="dscim.menu.main_recipe.MainRecipe" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">dscim.menu.main_recipe.MainRecipe</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="dscim.menu.simple_storage.StackedDamages" href="../simple_storage/#dscim.menu.simple_storage.StackedDamages">StackedDamages</a></code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Main class for DSCIM execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>discounting_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Choice of discounting: <code>euler_gwr</code>, <code>euler_ramsey</code>, <code>constant</code>, <code>constant_gwr</code>, <code>naive_ramsey</code>,
<code>naive_gwr</code>, <code>gwr_gwr</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>discrete_discounting</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Discounting is discrete if <code>True</code>, else continuous (default is <code>False</code>).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fit_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of damage function estimation: <code>'ols'</code>, <code>'quantreg'</code></p>
              </div>
            </td>
            <td>
                  <code>&#39;ols&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weitzman_parameter</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If &lt;= 1: The share of global consumption below which bottom coding is implemented.
If &gt; 1: Absolute dollar value of global consumption below which bottom.
Default is [0.1, 0.5].
coding is implemented.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fair_aggregation</code>
            </td>
            <td>
                  <code>list of str or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to value climate uncertainty from FAIR: <code>median</code>, <code>mean</code>,
<code>ce</code>, <code>median_params</code>. Default is ["ce", "mean", "gwr_mean",
"median", "median_params"].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rho</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pure rate of time preference parameter</p>
              </div>
            </td>
            <td>
                  <code>0.00461878399</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fair_dims</code>
            </td>
            <td>
                  <code>list of str or None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dimensions over which the FAIR CE/mean/median options should be collapsed. Default value is ["simulation"], but lists such as ["simulation", "rcp", "ssp"] can be passed. Note: If dimensions other than 'simulation' are passed, 'median_params' fair aggregation cannot be passed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>












<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.calculate_discount_factors" href="#dscim.menu.main_recipe.MainRecipe.calculate_discount_factors">calculate_discount_factors</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculates the stream of discount factors based on the Euler equation that defines an optimal</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.calculate_scc" href="#dscim.menu.main_recipe.MainRecipe.calculate_scc">calculate_scc</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate range of FAIR-aggregated SCCs</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.calculate_stream_discount_factors" href="#dscim.menu.main_recipe.MainRecipe.calculate_stream_discount_factors">calculate_stream_discount_factors</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Stream of discount factors</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.calculated_damages


  
      abstractmethod
  " href="#dscim.menu.main_recipe.MainRecipe.calculated_damages">calculated_damages</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate damages (difference between CEs) for collapsing</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce" href="#dscim.menu.main_recipe.MainRecipe.ce">ce</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Rechunk data appropriately and apply the certainty equivalence</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce_cc_calculation


  
      abstractmethod
  " href="#dscim.menu.main_recipe.MainRecipe.ce_cc_calculation">ce_cc_calculation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate CE damages depending on discount type</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce_no_cc_calculation


  
      abstractmethod
  " href="#dscim.menu.main_recipe.MainRecipe.ce_no_cc_calculation">ce_no_cc_calculation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate GDP CE depending on discount type.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.collapsed_pop" href="#dscim.menu.main_recipe.MainRecipe.collapsed_pop">collapsed_pop</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Collapse population according to discount type.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.damage_function" href="#dscim.menu.main_recipe.MainRecipe.damage_function">damage_function</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calls damage function calculation method.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.damage_function_calculation" href="#dscim.menu.main_recipe.MainRecipe.damage_function_calculation">damage_function_calculation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>The damage function model fit may be : (1) ssp specific, (2) ssp-model specific, (3) unique across ssp-model.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.damage_function_points" href="#dscim.menu.main_recipe.MainRecipe.damage_function_points">damage_function_points</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Global damages by RCP/GCM or SLR</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.discounted_damages" href="#dscim.menu.main_recipe.MainRecipe.discounted_damages">discounted_damages</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Discount marginal damages. Distinguishes between constant discount rates method and non-constant discount rates.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.full_uncertainty_iqr" href="#dscim.menu.main_recipe.MainRecipe.full_uncertainty_iqr">full_uncertainty_iqr</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the distribution of quantile-weighted SCCs produced from</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.global_consumption" href="#dscim.menu.main_recipe.MainRecipe.global_consumption">global_consumption</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Global consumption without climate change</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.global_consumption_calculation


  
      abstractmethod
  " href="#dscim.menu.main_recipe.MainRecipe.global_consumption_calculation">global_consumption_calculation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculation of global consumption without climate change</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.global_consumption_no_pulse" href="#dscim.menu.main_recipe.MainRecipe.global_consumption_no_pulse">global_consumption_no_pulse</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Global consumption under FAIR control scenario.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.global_consumption_per_capita" href="#dscim.menu.main_recipe.MainRecipe.global_consumption_per_capita">global_consumption_per_capita</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Global consumption per capita</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.global_consumption_pulse" href="#dscim.menu.main_recipe.MainRecipe.global_consumption_pulse">global_consumption_pulse</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Global consumption under FAIR pulse scenario.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.global_damages_calculation


  
      abstractmethod
  " href="#dscim.menu.main_recipe.MainRecipe.global_damages_calculation">global_damages_calculation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate global collapsed damages for a desired discount type</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.marginal_damages" href="#dscim.menu.main_recipe.MainRecipe.marginal_damages">marginal_damages</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Marginal damages due to additional pulse</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.order_plate" href="#dscim.menu.main_recipe.MainRecipe.order_plate">order_plate</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Execute menu option section and save results</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.order_scc" href="#dscim.menu.main_recipe.MainRecipe.order_scc">order_scc</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Execute menu option section and save results</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.stat_uncertainty_iqr" href="#dscim.menu.main_recipe.MainRecipe.stat_uncertainty_iqr">stat_uncertainty_iqr</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the distribution of quantile-weighted SCCs produced from</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.uncollapsed_sccs" href="#dscim.menu.main_recipe.MainRecipe.uncollapsed_sccs">uncollapsed_sccs</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate full distribution of SCCs without FAIR aggregation</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.weitzman_min" href="#dscim.menu.main_recipe.MainRecipe.weitzman_min">weitzman_min</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Implements bottom coding that fixes marginal utility below a threshold</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce_cc


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.ce_cc">ce_cc</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Certainty equivalent of consumption with climate change damages</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce_fair_no_pulse


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.ce_fair_no_pulse">ce_fair_no_pulse</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Certainty equivalent of global consumption under FAIR control scenario</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce_fair_pulse


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.ce_fair_pulse">ce_fair_pulse</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Certainty equivalent of global consumption under FAIR pulse scenario</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.ce_no_cc


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.ce_no_cc">ce_no_cc</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Certainty equivalent of consumption without climate change damages</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.damage_function_coefficients


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.damage_function_coefficients">damage_function_coefficients</a></code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Load damage function coefficients if the coefficients are provided by the user.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.damage_function_fit


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.damage_function_fit">damage_function_fit</a></code></td>
            <td>
                  <code><span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Load fitted damage function if the fit is provided by the user.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.gmsl_max


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.gmsl_max">gmsl_max</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This function finds the GMSL value at which the damage function</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.median_params_marginal_damages


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.median_params_marginal_damages">median_params_marginal_damages</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Calculate marginal damages due to a pulse using a FAIR simulation</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dscim.menu.main_recipe.MainRecipe.output_attrs


  
      property
  " href="#dscim.menu.main_recipe.MainRecipe.output_attrs">output_attrs</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Return dict with class attributes for output metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MainRecipe</span><span class="p">(</span><span class="n">StackedDamages</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main class for DSCIM execution.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    discounting_type : str</span>
<span class="sd">        Choice of discounting: ``euler_gwr``, ``euler_ramsey``, ``constant``, ``constant_gwr``, ``naive_ramsey``,</span>
<span class="sd">        ``naive_gwr``, ``gwr_gwr``.</span>
<span class="sd">    discrete_discounting: boolean</span>
<span class="sd">        Discounting is discrete if ``True``, else continuous (default is ``False``).</span>
<span class="sd">    fit_type : str</span>
<span class="sd">        Type of damage function estimation: ``&#39;ols&#39;``, ``&#39;quantreg&#39;``</span>
<span class="sd">    weitzman_parameter: list of float or None, optional</span>
<span class="sd">        If &lt;= 1: The share of global consumption below which bottom coding is implemented.</span>
<span class="sd">        If &gt; 1: Absolute dollar value of global consumption below which bottom.</span>
<span class="sd">        Default is [0.1, 0.5].</span>
<span class="sd">        coding is implemented.</span>
<span class="sd">    fair_aggregation : list of str or None, optional</span>
<span class="sd">        How to value climate uncertainty from FAIR: ``median``, ``mean``,</span>
<span class="sd">        ``ce``, ``median_params``. Default is [&quot;ce&quot;, &quot;mean&quot;, &quot;gwr_mean&quot;,</span>
<span class="sd">        &quot;median&quot;, &quot;median_params&quot;].</span>
<span class="sd">    rho : float</span>
<span class="sd">        Pure rate of time preference parameter</span>
<span class="sd">    fair_dims : list of str or None, optional</span>
<span class="sd">        List of dimensions over which the FAIR CE/mean/median options should be collapsed. Default value is [&quot;simulation&quot;], but lists such as [&quot;simulation&quot;, &quot;rcp&quot;, &quot;ssp&quot;] can be passed. Note: If dimensions other than &#39;simulation&#39; are passed, &#39;median_params&#39; fair aggregation cannot be passed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">CONST_DISC_RATES</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
    <span class="n">DISCOUNT_TYPES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
        <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;constant_gwr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;naive_ramsey&quot;</span><span class="p">,</span>
        <span class="s2">&quot;euler_ramsey&quot;</span><span class="p">,</span>
        <span class="s2">&quot;naive_gwr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;gwr_gwr&quot;</span><span class="p">,</span>
        <span class="s2">&quot;euler_gwr&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">FORMULAS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;damages ~ -1 + np.power(anomaly, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + gmsl&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ anomaly + np.power(anomaly, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + anomaly + np.power(anomaly, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + gmsl + anomaly + np.power(anomaly, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + anomaly + np.power(anomaly, 2) + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + anomaly * gmsl + anomaly * np.power(gmsl, 2) + gmsl * np.power(anomaly, 2) + np.power(anomaly, 2) * np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ anomaly + np.power(anomaly, 2) + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + anomaly:gmsl + anomaly:np.power(gmsl, 2) + gmsl:np.power(anomaly, 2) + np.power(anomaly, 2):np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damages ~ -1 + gmsl:anomaly + gmsl:np.power(anomaly, 2)&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">econ_vars</span><span class="p">,</span>
        <span class="n">climate_vars</span><span class="p">,</span>
        <span class="n">sector</span><span class="p">,</span>
        <span class="n">formula</span><span class="p">,</span>
        <span class="n">sector_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">rho</span><span class="o">=</span><span class="mf">0.00461878399</span><span class="p">,</span>
        <span class="n">eta</span><span class="o">=</span><span class="mf">1.421158116</span><span class="p">,</span>
        <span class="n">fit_type</span><span class="o">=</span><span class="s2">&quot;ols&quot;</span><span class="p">,</span>
        <span class="n">discounting_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ext_method</span><span class="o">=</span><span class="s2">&quot;global_c_ratio&quot;</span><span class="p">,</span>
        <span class="n">ext_subset_start_year</span><span class="o">=</span><span class="mi">2085</span><span class="p">,</span>
        <span class="n">ext_subset_end_year</span><span class="o">=</span><span class="mi">2099</span><span class="p">,</span>
        <span class="n">ext_end_year</span><span class="o">=</span><span class="mi">2300</span><span class="p">,</span>
        <span class="n">subset_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ce_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">damage_function_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">clip_gmsl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">gdppc_bottom_code</span><span class="o">=</span><span class="mf">39.39265060424805</span><span class="p">,</span>
        <span class="n">scc_quantiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scenario_dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">weitzman_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fair_aggregation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">filename_suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">discrete_discounting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">quantreg_quantiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">quantreg_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">full_uncertainty_quantiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">extrap_formula</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fair_dims</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">save_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">scc_quantiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scc_quantiles</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">weitzman_parameter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">weitzman_parameter</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fair_aggregation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fair_aggregation</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ce&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;gwr_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="s2">&quot;median_params&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">quantreg_quantiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quantreg_quantiles</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.1</span><span class="p">,</span>
                <span class="mf">0.15</span><span class="p">,</span>
                <span class="mf">0.2</span><span class="p">,</span>
                <span class="mf">0.25</span><span class="p">,</span>
                <span class="mf">0.3</span><span class="p">,</span>
                <span class="mf">0.35</span><span class="p">,</span>
                <span class="mf">0.4</span><span class="p">,</span>
                <span class="mf">0.45</span><span class="p">,</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="mf">0.55</span><span class="p">,</span>
                <span class="mf">0.6</span><span class="p">,</span>
                <span class="mf">0.65</span><span class="p">,</span>
                <span class="mf">0.7</span><span class="p">,</span>
                <span class="mf">0.75</span><span class="p">,</span>
                <span class="mf">0.8</span><span class="p">,</span>
                <span class="mf">0.85</span><span class="p">,</span>
                <span class="mf">0.9</span><span class="p">,</span>
                <span class="mf">0.95</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">quantreg_weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quantreg_weights</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mf">0.075</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.075</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">full_uncertainty_quantiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">full_uncertainty_quantiles</span> <span class="o">=</span> <span class="p">[</span>
                <span class="mf">0.01</span><span class="p">,</span>
                <span class="mf">0.05</span><span class="p">,</span>
                <span class="mf">0.17</span><span class="p">,</span>
                <span class="mf">0.25</span><span class="p">,</span>
                <span class="mf">0.5</span><span class="p">,</span>
                <span class="mf">0.75</span><span class="p">,</span>
                <span class="mf">0.83</span><span class="p">,</span>
                <span class="mf">0.95</span><span class="p">,</span>
                <span class="mf">0.99</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">fair_dims</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fair_dims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;simulation&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">save_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">save_files</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;damage_function_points&quot;</span><span class="p">,</span>
                <span class="s2">&quot;damage_function_coefficients&quot;</span><span class="p">,</span>
                <span class="s2">&quot;damage_function_fit&quot;</span><span class="p">,</span>
                <span class="s2">&quot;marginal_damages&quot;</span><span class="p">,</span>
                <span class="s2">&quot;discount_factors&quot;</span><span class="p">,</span>
                <span class="s2">&quot;uncollapsed_sccs&quot;</span><span class="p">,</span>
                <span class="s2">&quot;scc&quot;</span><span class="p">,</span>
                <span class="s2">&quot;uncollapsed_discount_factors&quot;</span><span class="p">,</span>
                <span class="s2">&quot;uncollapsed_marginal_damages&quot;</span><span class="p">,</span>
                <span class="s2">&quot;global_consumption&quot;</span><span class="p">,</span>
                <span class="s2">&quot;global_consumption_no_pulse&quot;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">sector_path</span><span class="o">=</span><span class="n">sector_path</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
            <span class="n">econ_vars</span><span class="o">=</span><span class="n">econ_vars</span><span class="p">,</span>
            <span class="n">climate_vars</span><span class="o">=</span><span class="n">climate_vars</span><span class="p">,</span>
            <span class="n">gdppc_bottom_code</span><span class="o">=</span><span class="n">gdppc_bottom_code</span><span class="p">,</span>
            <span class="n">eta</span><span class="o">=</span><span class="n">eta</span><span class="p">,</span>
            <span class="n">subset_dict</span><span class="o">=</span><span class="n">subset_dict</span><span class="p">,</span>
            <span class="n">ce_path</span><span class="o">=</span><span class="n">ce_path</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span> <span class="o">=</span> <span class="n">fit_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span> <span class="o">=</span> <span class="n">fair_aggregation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_suffix</span> <span class="o">=</span> <span class="n">filename_suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span> <span class="o">=</span> <span class="n">weitzman_parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discrete_discounting</span> <span class="o">=</span> <span class="n">discrete_discounting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">=</span> <span class="n">discounting_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sector</span> <span class="o">=</span> <span class="n">sector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_path</span> <span class="o">=</span> <span class="n">save_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span> <span class="o">=</span> <span class="n">damage_function_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_start_year</span> <span class="o">=</span> <span class="n">ext_subset_start_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">=</span> <span class="n">ext_subset_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span> <span class="o">=</span> <span class="n">ext_end_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span> <span class="o">=</span> <span class="n">ext_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span> <span class="o">=</span> <span class="n">clip_gmsl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span> <span class="o">=</span> <span class="n">scenario_dimensions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scc_quantiles</span> <span class="o">=</span> <span class="n">scc_quantiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span> <span class="o">=</span> <span class="n">quantreg_quantiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quantreg_weights</span> <span class="o">=</span> <span class="n">quantreg_weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_quantiles</span> <span class="o">=</span> <span class="n">full_uncertainty_quantiles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ce_path</span> <span class="o">=</span> <span class="n">ce_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extrap_formula</span> <span class="o">=</span> <span class="n">extrap_formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span> <span class="o">=</span> <span class="n">fair_dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_files</span> <span class="o">=</span> <span class="n">save_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">quantreg_weights</span>
            <span class="p">),</span> <span class="s2">&quot;Length of quantreg quantiles does not match length of weights.&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DISCOUNT_TYPES</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Discount type not implemented. Try one of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">DISCOUNT_TYPES</span><span class="si">}</span><span class="s2">.&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FORMULAS</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Formula not implemented. Try one of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">FORMULAS</span><span class="si">}</span><span class="s2">.&quot;</span>

        <span class="c1"># Set stream of discounts to None if discounting_type is &#39;constant&#39;</span>
        <span class="c1"># &#39;constant_model_collapsed&#39; should be here except that we allow</span>
        <span class="c1"># for a collapsed-model Ramsey rate to be calculated (for labour</span>
        <span class="c1"># and energy purposes)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;constant&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;constant_gwr&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream_discount_factors</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># assert formulas for which clip_gmsl is implemented</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;damages ~ -1 + anomaly + np.power(anomaly, 2) + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;damages ~ -1 + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
            <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Running </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="si">}</span>
<span class="s2">        sector: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sector</span><span class="si">}</span>
<span class="s2">        discounting: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="si">}</span>
<span class="s2">        eta: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="si">}</span>
<span class="s2">        rho: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">order_plate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute menu option section and save results</span>

<span class="sd">        This method is a entry point to the class and allows the user to</span>
<span class="sd">        calculate different elements of a specific menu option. These elements</span>
<span class="sd">        will automatically be saved in the path defined in `save_path`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        course str</span>
<span class="sd">            Output to be calculated. Options are:</span>
<span class="sd">                - `damage_function`: Return and save all damage function</span>
<span class="sd">                  elements including damage function points, coefficients, and</span>
<span class="sd">                  fitted values.</span>
<span class="sd">                - `scc`: Return Social Cost of Carbon calculation. All elements</span>
<span class="sd">                from `damage_function` are saved and returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None. Saved all elements to `save_path`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Executing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">damage_function</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing damage functions ...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Existing damage functions not found. Damage points will be loaded.&quot;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_points</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_fit</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">scc</span><span class="p">():</span>
            <span class="n">damage_function</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing SCC calculation ...&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span> <span class="o">==</span> <span class="s2">&quot;quantreg&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_iqr</span>
                <span class="c1"># stat_uncertainty_iqr function expects collapsed SCCs, so a fair aggregation is required</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stat_uncertainty_iqr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stream_discount_factors</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_sccs</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_marginal_damages</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_discount_factors</span>

        <span class="n">course_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;damage_function&quot;</span><span class="p">:</span> <span class="n">damage_function</span><span class="p">,</span> <span class="s2">&quot;scc&quot;</span><span class="p">:</span> <span class="n">scc</span><span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">course_dict</span><span class="p">[</span><span class="n">course</span><span class="p">]()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">course</span><span class="si">}</span><span class="s2"> is not a valid option: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error detected.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">order_scc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute menu option section and save results</span>

<span class="sd">        This method is a wrapper to `order_plate` that calls the &quot;scc&quot; course,</span>
<span class="sd">        which is the Social Cost of Carbon calculation. Elements involved in the calculation</span>
<span class="sd">        (`fair` and `damage_function`) will automatically be saved in the path</span>
<span class="sd">        defined in `save_path`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xr.Dataset of SCCs</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Executing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">sccds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error detected.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;rcp45&quot;</span> <span class="ow">in</span> <span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;rcp85&quot;</span> <span class="ow">in</span> <span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">):</span>
            <span class="c1"># leave the dataset alone if there are already rcp scenario names</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># rename the CMIP6 scenario names that start with &quot;ssp*&quot;</span>
            <span class="n">sccds</span> <span class="o">=</span> <span class="n">sccds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">)</span>

            <span class="n">rcpdt</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;ssp126&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP2.6&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ssp245&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP4.5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ssp370&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP7.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ssp460&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP6.0&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ssp585&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP8.5&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">rlst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rcp</span> <span class="ow">in</span> <span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rcpdt</span><span class="p">[</span><span class="n">rcp</span><span class="p">])</span>
            <span class="n">sccds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;rcp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rlst</span>
            <span class="n">sccds</span> <span class="o">=</span> <span class="n">sccds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sccds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">output_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return dict with class attributes for output metadata</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">            A dict Class metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># find machine name</span>
        <span class="n">machine_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;HOSTNAME&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">machine_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">machine_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">uname</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">machine_name</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

        <span class="c1"># find git commit hash</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;describe&quot;</span><span class="p">,</span> <span class="s2">&quot;--always&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">attr_dict</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
            <span class="nb">vars</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="s2">&quot;climate&quot;</span><span class="p">]),</span>
            <span class="nb">vars</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="s2">&quot;econ_vars&quot;</span><span class="p">]),</span>
        <span class="p">]:</span>
            <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">attr_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">])</span>
                    <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;damage_function&quot;</span><span class="p">,</span> <span class="s2">&quot;logger&quot;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="c1"># update with git hash and machine name</span>
        <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">machine</span><span class="o">=</span><span class="n">machine_name</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="n">label</span><span class="p">))</span>

        <span class="c1"># convert to strs</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">meta</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

        <span class="k">return</span> <span class="n">meta</span>

    <span class="nd">@cachedproperty</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">collapsed_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collapse population according to discount type.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;ramsey&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">):</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">:</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">&quot;gwr&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">:</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;ssp&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pop</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ce_cc_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate CE damages depending on discount type&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ce_no_cc_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate GDP CE depending on discount type.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculated_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate damages (difference between CEs) for collapsing&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">global_damages_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate global collapsed damages for a desired discount type&quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ce_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Certainty equivalent of consumption with climate change damages&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce_cc_calculation</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ce_no_cc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Certainty equivalent of consumption without climate change damages&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce_no_cc_calculation</span><span class="p">()</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;damage_function_points&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_function_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Global damages by RCP/GCM or SLR</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">            pd.DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_damages_calculation</span><span class="p">()</span>

        <span class="k">if</span> <span class="s2">&quot;slr&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">gmsl</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;slr&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;gcm&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">gmst</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;gcm&quot;</span><span class="p">,</span> <span class="s2">&quot;rcp&quot;</span><span class="p">])</span>

        <span class="c1"># removing illegal combinations from estimation</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SSP1&quot;</span><span class="p">,</span> <span class="s2">&quot;SSP5&quot;</span><span class="p">]]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropping illegal model combinations.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;anomaly&quot;</span><span class="p">,</span> <span class="s2">&quot;gmsl&quot;</span><span class="p">]]:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                    <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">ssp</span> <span class="o">==</span> <span class="s2">&quot;SSP1&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rcp</span> <span class="o">==</span> <span class="s2">&quot;rcp85&quot;</span><span class="p">))</span>
                    <span class="o">|</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">ssp</span> <span class="o">==</span> <span class="s2">&quot;SSP5&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rcp</span> <span class="o">==</span> <span class="s2">&quot;rcp45&quot;</span><span class="p">)),</span>
                    <span class="n">var</span><span class="p">,</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># agriculture lacks ACCESS0-1/rcp85 combo</span>
        <span class="k">if</span> <span class="s2">&quot;agriculture&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropping illegal model combinations for agriculture.&quot;</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">gcm</span> <span class="o">==</span> <span class="s2">&quot;ACCESS1-0&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rcp</span> <span class="o">==</span> <span class="s2">&quot;rcp85&quot;</span><span class="p">),</span> <span class="s2">&quot;anomaly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">damage_function_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">damage_function_points</span><span class="p">,</span> <span class="n">global_consumption</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The damage function model fit may be : (1) ssp specific, (2) ssp-model specific, (3) unique across ssp-model.</span>
<span class="sd">        This depends on the type of discounting. In each case the input data passed to the fitting functions and the formatting of the returned</span>
<span class="sd">        output is different because dimensions are different. This function handles this and returns the model fit.</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">        dict with two xr.Datasets, &#39;params&#39; (model fit) and &#39;preds&#39; (predictions from model fit), with dimensions depending</span>
<span class="sd">        on self.discounting_type.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">yrs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">params_list</span><span class="p">,</span> <span class="n">preds_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ssp</span> <span class="ow">in</span> <span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
                <span class="c1"># Subset dataframe to specific SSP</span>
                <span class="n">fit_subset</span> <span class="o">=</span> <span class="n">damage_function_points</span><span class="p">[</span>
                    <span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ssp</span>
                <span class="p">]</span>

                <span class="n">global_c_subset</span> <span class="o">=</span> <span class="n">global_consumption</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s2">&quot;ssp&quot;</span><span class="p">:</span> <span class="n">ssp</span><span class="p">})</span>
                <span class="c1"># Fit damage function curves using the data subset</span>
                <span class="n">damage_function</span> <span class="o">=</span> <span class="n">model_outputs</span><span class="p">(</span>
                    <span class="n">damage_function</span><span class="o">=</span><span class="n">fit_subset</span><span class="p">,</span>
                    <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                    <span class="n">type_estimation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span><span class="p">,</span>
                    <span class="n">global_c</span><span class="o">=</span><span class="n">global_c_subset</span><span class="p">,</span>
                    <span class="n">extrapolation_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span><span class="p">,</span>
                    <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">,</span>
                    <span class="n">year_range</span><span class="o">=</span><span class="n">yrs</span><span class="p">,</span>
                    <span class="n">year_start_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Add variables</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                        <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span>
                        <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">preds</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                        <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span>
                        <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                <span class="n">preds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="s2">&quot;ramsey&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="n">ssp</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">product</span><span class="p">(</span>
                    <span class="n">damage_function_points</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
                    <span class="n">damage_function_points</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># Subset dataframe to specific SSP-IAM combination.</span>
                <span class="n">fit_subset</span> <span class="o">=</span> <span class="n">damage_function_points</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ssp</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="n">global_c_subset</span> <span class="o">=</span> <span class="n">global_consumption</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s2">&quot;ssp&quot;</span><span class="p">:</span> <span class="n">ssp</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">})</span>

                <span class="c1"># Fit damage function curves using the data subset</span>
                <span class="n">damage_function</span> <span class="o">=</span> <span class="n">model_outputs</span><span class="p">(</span>
                    <span class="n">damage_function</span><span class="o">=</span><span class="n">fit_subset</span><span class="p">,</span>
                    <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                    <span class="n">type_estimation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span><span class="p">,</span>
                    <span class="n">global_c</span><span class="o">=</span><span class="n">global_c_subset</span><span class="p">,</span>
                    <span class="n">extrapolation_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span><span class="p">,</span>
                    <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">,</span>
                    <span class="n">year_range</span><span class="o">=</span><span class="n">yrs</span><span class="p">,</span>
                    <span class="n">year_start_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Add variables</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span> <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">preds</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span> <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                <span class="n">preds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;gwr&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">:</span>
            <span class="c1"># Fit damage function across all SSP-IAM combinations, as expected</span>
            <span class="c1"># from the Weitzman-Ramsey discounting</span>
            <span class="n">fit_subset</span> <span class="o">=</span> <span class="n">damage_function_points</span>

            <span class="c1"># Fit damage function curves using the data subset</span>
            <span class="n">damage_function</span> <span class="o">=</span> <span class="n">model_outputs</span><span class="p">(</span>
                <span class="n">damage_function</span><span class="o">=</span><span class="n">fit_subset</span><span class="p">,</span>
                <span class="n">type_estimation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span><span class="p">,</span>
                <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                <span class="n">global_c</span><span class="o">=</span><span class="n">global_consumption</span><span class="p">,</span>
                <span class="n">extrapolation_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span><span class="p">,</span>
                <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">,</span>
                <span class="n">year_range</span><span class="o">=</span><span class="n">yrs</span><span class="p">,</span>
                <span class="n">year_start_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Add variables</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                    <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                    <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">preds</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                    <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                    <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">preds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">params</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span><span class="n">params_list</span><span class="p">),</span>
            <span class="n">preds</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span><span class="n">preds_list</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@cachedproperty</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calls damage function calculation method.</span>

<span class="sd">        This function calls the damage function calculation in</span>
<span class="sd">        model_outputs(). It calculates a damage function for each</span>
<span class="sd">        passed `scenario_dimension` based on subsets of</span>
<span class="sd">        self.damage_function_points and extrapolates this function</span>
<span class="sd">        using the specified method for all years post-end_ext_subset_year.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            dict[&#39;params&#39;] is a dataframe of betas for each year</span>
<span class="sd">            dict[&#39;preds&#39;] is a dataframe of predicted y hat for each</span>
<span class="sd">                year and anomaly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># this only occurs for global discounting</span>
            <span class="c1"># with a single scenario passed</span>
            <span class="n">damage_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_calculation</span><span class="p">(</span>
                <span class="n">damage_function_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_points</span><span class="p">,</span>
                <span class="n">global_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># cycle through the different combinations of the scenario dims</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span><span class="p">)</span>
            <span class="n">damage_function</span><span class="p">,</span> <span class="n">dict_list</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
                <span class="c1"># turn single-dim into a tuple to make indexing easier later</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">name</span><span class="p">])</span>

                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_calculation</span><span class="p">(</span>
                    <span class="n">damage_function_points</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                    <span class="n">global_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># assigning dimensions to each dataArray in the dictionary</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="n">var</span><span class="p">:</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

            <span class="c1"># concatenate different scenarios into one big dataArray</span>
            <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span>
                <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">damage_function</span>

    <span class="nd">@property</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;damage_function_coefficients&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_function_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load damage function coefficients if the coefficients are provided by the user.</span>
<span class="sd">        Otherwise, compute them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="si">}</span><span class="s2">_eta</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="si">}</span><span class="s2">_rho</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="si">}</span><span class="s2">_damage_function_coefficients.nc4&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;damage_function_fit&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">damage_function_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load fitted damage function if the fit is provided by the user.</span>
<span class="sd">        Otherwise, compute them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">NAME</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="si">}</span><span class="s2">_eta</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="si">}</span><span class="s2">_rho</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="si">}</span><span class="s2">_damage_function_fit.nc4&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">median_params_marginal_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate marginal damages due to a pulse using a FAIR simulation</span>
<span class="sd">        calculated with the median climate parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fair_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_median_params_control</span>
        <span class="n">fair_pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_median_params_pulse</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span><span class="p">:</span>
            <span class="n">fair_control</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fair_control</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsl_max</span><span class="p">)</span>
            <span class="n">fair_pulse</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fair_pulse</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsl_max</span><span class="p">)</span>

        <span class="n">damages_pulse</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
            <span class="n">fair_pulse</span><span class="p">,</span>
            <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
            <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">damages_no_pulse</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
            <span class="n">fair_control</span><span class="p">,</span>
            <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
            <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">median_params_marginal_damages</span> <span class="o">=</span> <span class="n">damages_pulse</span> <span class="o">-</span> <span class="n">damages_no_pulse</span>

        <span class="c1"># collapse further if further collapsing dimensions are provided</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">median_params_marginal_damages</span> <span class="o">=</span> <span class="n">median_params_marginal_damages</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">median_params_marginal_damages</span><span class="o">.</span><span class="n">dims</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># add a Weitzman parameter dimension so this dataset can be concatenated</span>
        <span class="c1"># with the other FAIR aggregation results</span>
        <span class="n">median_params_marginal_damages</span> <span class="o">=</span> <span class="n">median_params_marginal_damages</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span><span class="p">]}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">median_params_marginal_damages</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculation of global consumption without climate change</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            xr.DataArray</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_per_capita</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Global consumption per capita</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            xr.DataArray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Calculate global consumption per capita</span>
        <span class="n">array_pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_calculation</span><span class="p">(</span>
            <span class="n">disc_type</span>
        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">==</span> <span class="s2">&quot;equity&quot;</span><span class="p">:</span>
            <span class="c1"># equity recipe&#39;s growth is capped to</span>
            <span class="c1"># risk aversion recipe&#39;s growth rates</span>
            <span class="n">extrapolated</span> <span class="o">=</span> <span class="n">extrapolate</span><span class="p">(</span>
                <span class="n">xr_array</span><span class="o">=</span><span class="n">array_pc</span><span class="p">,</span>
                <span class="n">start_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_start_year</span><span class="p">,</span>
                <span class="n">end_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span><span class="p">,</span>
                <span class="n">interp_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;growth_constant&quot;</span><span class="p">,</span>
                <span class="n">cap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">risk_aversion_growth_rates</span><span class="p">(),</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">extrapolated</span> <span class="o">=</span> <span class="n">extrapolate</span><span class="p">(</span>
                <span class="n">xr_array</span><span class="o">=</span><span class="n">array_pc</span><span class="p">,</span>
                <span class="n">start_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_start_year</span><span class="p">,</span>
                <span class="n">end_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span><span class="p">,</span>
                <span class="n">interp_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;growth_constant&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">complete_array</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">array_pc</span><span class="p">,</span> <span class="n">extrapolated</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">complete_array</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_consumption&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">global_consumption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Global consumption without climate change&quot;&quot;&quot;</span>

        <span class="c1"># rff simulation means that GDP already exists out to 2300</span>
        <span class="k">if</span> <span class="mi">2300</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Global consumption found up to 2300.&quot;</span><span class="p">)</span>
            <span class="n">global_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;global_consumption&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extrapolating global consumption.&quot;</span><span class="p">)</span>

            <span class="c1"># holding population constant</span>
            <span class="c1"># from 2100 to 2300 with 2099 values</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
                <span class="n">year</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Calculate global consumption back by</span>
            <span class="n">global_cons</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_per_capita</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">)</span> <span class="o">*</span> <span class="n">pop</span>
            <span class="p">)</span>

        <span class="c1"># Add dimension</span>
        <span class="c1"># @TODO: remove this line altogether</span>
        <span class="n">global_cons</span> <span class="o">=</span> <span class="n">global_cons</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;discount_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">]}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">global_cons</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">weitzman_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_cc_consumption</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements bottom coding that fixes marginal utility below a threshold</span>
<span class="sd">        to the marginal utility at that threshold. The threshold is the Weitzman</span>
<span class="sd">        parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        no_cc_consumption: xr.DataArray</span>
<span class="sd">            Consumption array of which the share will be used to calculate</span>
<span class="sd">            the absolute Weitzman parameter, only if parameter &lt;= 1.</span>
<span class="sd">        consumption: xr.DataArray</span>
<span class="sd">            Consumption array to be bottom-coded.</span>
<span class="sd">        parameter: float</span>
<span class="sd">            A positive number representing the Weitzman parameter, below which marginal utility will be</span>
<span class="sd">            top coded; ie., 0.01 implies marginal utility is top coded to the</span>
<span class="sd">            value of marginal utility at 1% of no-climate change global consumption.</span>
<span class="sd">            If parameter &gt; 1, it is assumed to be an absolute value.</span>
<span class="sd">            If parameter &lt;= 1, it is assumed to be a share of future global consumption</span>
<span class="sd">            (without climate change).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            xr.Dataset</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if parameter is share of consumption,</span>
        <span class="c1"># multiply by no-climate-change consumption</span>
        <span class="k">if</span> <span class="n">parameter</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameter</span> <span class="o">*</span> <span class="n">no_cc_consumption</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">w_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
            <span class="n">bottom_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">parameter</span> <span class="o">-</span> <span class="n">cc_consumption</span><span class="p">)</span>
            <span class="n">bottom_coded_cons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">w_utility</span> <span class="o">-</span> <span class="n">bottom_utility</span><span class="p">)</span>

            <span class="n">clipped_cons</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">cc_consumption</span> <span class="o">&gt;</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">bottom_coded_cons</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
            <span class="n">bottom_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">parameter</span> <span class="o">-</span> <span class="n">cc_consumption</span>
            <span class="p">)</span>
            <span class="n">bottom_coded_cons</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span>
                <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">w_utility</span> <span class="o">-</span> <span class="n">bottom_utility</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="n">clipped_cons</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">cc_consumption</span> <span class="o">&gt;</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">bottom_coded_cons</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">clipped_cons</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gmsl_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function finds the GMSL value at which the damage function</span>
<span class="sd">        reaches its local maximum along the GMSL dimension.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xr.DataArray</span>
<span class="sd">            the array of GMSL values at which the local maximum is located, for all</span>
<span class="sd">            years, ssps, models, and if applicable, values of GMST</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;damages ~ -1 + anomaly + np.power(anomaly, 2) + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;damages ~ -1 + gmsl + np.power(gmsl, 2)&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">gmsl_max</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">[</span><span class="s2">&quot;np.power(gmsl, 2)&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># if the damage function curves up, there is no local max.</span>
            <span class="c1"># Thus there will be no linearization.</span>
            <span class="n">gmsl_max</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">[</span><span class="s2">&quot;np.power(gmsl, 2)&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
                <span class="n">gmsl_max</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># confirm that all max values are positive, which is expected</span>
            <span class="c1"># for our damage functions</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">gmsl_max</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">gmsl_max</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The first derivative w.r.t. gmsl for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="si">}</span><span class="s2"> has not been implemented in the menu.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">gmsl_max</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_consumption_no_pulse&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_no_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Global consumption under FAIR control scenario.&quot;&quot;&quot;</span>

        <span class="n">fair_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_control</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span><span class="p">:</span>
            <span class="n">fair_control</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fair_control</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsl_max</span><span class="p">)</span>

        <span class="n">damages</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
            <span class="n">fair_control</span><span class="p">,</span>
            <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
            <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cc_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span> <span class="o">-</span> <span class="n">damages</span>

        <span class="n">gc_no_pulse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span><span class="p">:</span>
            <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_min</span><span class="p">(</span>
                <span class="n">no_cc_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
                <span class="n">cc_consumption</span><span class="o">=</span><span class="n">cc_cons</span><span class="p">,</span>
                <span class="n">parameter</span><span class="o">=</span><span class="n">wp</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">gc</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">wp</span><span class="p">)})</span>

            <span class="n">gc_no_pulse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gc_no_pulse</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">)</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_consumption_pulse&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Global consumption under FAIR pulse scenario.&quot;&quot;&quot;</span>

        <span class="n">fair_pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_pulse</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span><span class="p">:</span>
            <span class="n">fair_pulse</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fair_pulse</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsl_max</span><span class="p">)</span>

        <span class="n">damages</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
            <span class="n">fair_pulse</span><span class="p">,</span>
            <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
            <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cc_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span> <span class="o">-</span> <span class="n">damages</span>
        <span class="n">gc_no_pulse</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span><span class="p">:</span>
            <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_min</span><span class="p">(</span>
                <span class="n">no_cc_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
                <span class="n">cc_consumption</span><span class="o">=</span><span class="n">cc_cons</span><span class="p">,</span>
                <span class="n">parameter</span><span class="o">=</span><span class="n">wp</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">gc</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">wp</span><span class="p">)})</span>
            <span class="n">gc_no_pulse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gc_no_pulse</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ce_fair_pulse&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ce_fair_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Certainty equivalent of global consumption under FAIR pulse scenario&quot;&quot;&quot;</span>
        <span class="n">ce_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_pulse</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ce_array</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;ce_fair_pulse&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;ce_fair_no_pulse&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ce_fair_no_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Certainty equivalent of global consumption under FAIR control scenario&quot;&quot;&quot;</span>

        <span class="n">ce_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ce_array</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;ce_fair_no_pulse&quot;</span><span class="p">)</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;marginal_damages&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">marginal_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marginal damages due to additional pulse&quot;&quot;&quot;</span>

        <span class="n">marginal_damages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;median&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;ce&quot;</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce_fair_no_pulse</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce_fair_pulse</span>
            <span class="k">elif</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;gwr_mean&quot;</span><span class="p">]:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span>
                <span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_pulse</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;median_params&quot;</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">median_params_marginal_damages</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2"> is not available. Enter list including&quot;</span>
                    <span class="s1">&#39;[&quot;ce&quot;, &quot;fair&quot;, &quot;median&quot;, &quot;median_params&quot;]&#39;</span>
                <span class="p">)</span>

            <span class="n">md</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">agg</span><span class="p">})</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="s2">&quot;fair_aggregation&quot;</span>
            <span class="p">)</span>

            <span class="c1"># convert to the marginal damages from a single tonne</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">md</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">conversion</span>
            <span class="n">marginal_damages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">marginal_damages</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">)</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;scc&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_scc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate range of FAIR-aggregated SCCs&quot;&quot;&quot;</span>

        <span class="n">discounted_damages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounted_damages</span><span class="p">(</span>
            <span class="n">damages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marginal_damages</span><span class="p">,</span> <span class="n">discrate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span>
        <span class="p">)</span>
        <span class="n">discounted_damages</span> <span class="o">=</span> <span class="n">discounted_damages</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;scc&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;median&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">:</span>
            <span class="n">median</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_sccs</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>
            <span class="n">median</span><span class="p">[</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span>
            <span class="n">discounted_damages</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">median</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;scc&quot;</span><span class="p">),</span> <span class="n">discounted_damages</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">discounted_damages</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">discounted_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">damages</span><span class="p">,</span> <span class="n">discrate</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Discount marginal damages. Distinguishes between constant discount rates method and non-constant discount rates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        damages : xr.DataArray or xr.Dataset</span>
<span class="sd">            Array of damages with a`discount_type` dimension to subset the damages.</span>
<span class="sd">        discrate : str</span>
<span class="sd">             Discounting type. Be aware that the constant rates are class-wide defined. If this str is either &#39;constant&#39; or &#39;constant_model_collapsed&#39;, the predetermined constant discount rates are used, otherwise, the stream of (non-constant) discount factors from self.stream_discount_factors() is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            xr.Dataset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">discrate</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">,</span> <span class="s2">&quot;constant_gwr&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete_discounting</span><span class="p">:</span>
                <span class="n">discrate_damages</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">damages</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="n">damages</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONST_DISC_RATES</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">discrate_damages</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">damages</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">damages</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONST_DISC_RATES</span>
                <span class="p">]</span>

            <span class="n">pvd_damages</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="n">discrate_damages</span><span class="p">,</span>
                <span class="n">dim</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONST_DISC_RATES</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;discrate&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_stream_discount_factors</span><span class="p">(</span>
                <span class="n">discounting_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">,</span>
                <span class="n">fair_aggregation</span><span class="o">=</span><span class="n">damages</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">pvd_damages</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">*</span> <span class="n">damages</span>

        <span class="k">return</span> <span class="n">pvd_damages</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;uncollapsed_sccs&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncollapsed_sccs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate full distribution of SCCs without FAIR aggregation&quot;&quot;&quot;</span>

        <span class="n">md</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_pulse</span>
        <span class="p">)</span>  <span class="c1"># this is for full uncertainty</span>

        <span class="c1"># convert to the marginal damages from a single pulse</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">md</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">conversion</span>

        <span class="n">md</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;uncollapsed&quot;</span><span class="p">]})</span>

        <span class="n">sccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounted_damages</span><span class="p">(</span>
            <span class="n">damages</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
            <span class="n">discrate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sccs</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;stat_uncertainty_iqr&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stat_uncertainty_iqr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the distribution of quantile-weighted SCCs produced from</span>
<span class="sd">        quantile regressions that have already been collapsed across other dimensions to give statistical-only uncertainty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">quantile_weight_quantilereg</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span><span class="p">,</span>
            <span class="n">fair_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">,</span>
            <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_quantiles</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;full_uncertainty_iqr&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">full_uncertainty_iqr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the distribution of quantile-weighted SCCs produced from</span>
<span class="sd">        quantile regressions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">quantile_weight_quantilereg</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_sccs</span><span class="p">,</span>
            <span class="n">fair_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">,</span>
            <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_quantiles</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_discount_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_pc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the stream of discount factors based on the Euler equation that defines an optimal</span>
<span class="sd">        intertemporal consumption allocation. Rearranging that equation shows that an outcome that will occur at the</span>
<span class="sd">        period t will be converted into today&#39;s, period 0 value, the following way :</span>

<span class="sd">        Discrete discounting: discount_factor_t = [ 1/(1+rho)^t ] * [ U&#39;(C(t)) / U&#39;(C(0)) ]</span>

<span class="sd">        where rho is the pure rate of time preference, U() is the utility function, U&#39;() the first derivative,</span>
<span class="sd">        C(0) and C(t) today&#39;s and the future consumption respectively. The higher rho, the higher the importance</span>
<span class="sd">        of the present relative to the future so the lower the discount factor, and, if the utility function is concave,</span>
<span class="sd">        the higher the growth of consumption, the lower the importance of the future consumption relative to today, and</span>
<span class="sd">        therefore again the lower the discount factor.</span>

<span class="sd">        Using a CRRA utility function and plugging the first derivative :</span>

<span class="sd">        discount_factor_t = [ 1/(1+rho)^t ] * [ C(0)^eta / C(t)^eta ]</span>

<span class="sd">        eta represents the degree of concavity of the utility function.</span>

<span class="sd">        With continuous discounting,</span>
<span class="sd">        discount_factor_t = Product_1^t [e^-(rho + eta * g),</span>
<span class="sd">            where g = ln(C(t)/C(t-1))</span>

<span class="sd">        rearranging yields rho_continuous = e^rho_discrete - 1</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cons_pc : array</span>
<span class="sd">            Array of per capita consumption from pulse year to end of time period.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `xarray.DataArray` with discount factors computed following the last equation in the above description.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># subset to pulse year onward</span>
        <span class="n">cons_pc</span> <span class="o">=</span> <span class="n">cons_pc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span><span class="p">))</span>

        <span class="c1"># calculate the time preference component of the discount factors for each period.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete_discounting</span><span class="p">:</span>
            <span class="c1"># plug the unique rho in an array</span>
            <span class="n">rhos</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">cons_pc</span><span class="o">.</span><span class="n">year</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># plug the unique rho in an array, and compute e^rho - 1</span>
            <span class="n">rhos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">cons_pc</span><span class="o">.</span><span class="n">year</span><span class="p">]))</span>

        <span class="n">stream_rhos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">accumulate</span><span class="p">((</span><span class="n">rhos</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rhos</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># calculate the marginal utility component of the discount factors for each period.</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">cons_pc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">/</span> <span class="n">cons_pc</span> <span class="o">**</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta</span>
        <span class="p">)</span>

        <span class="c1"># the discount factor is the product of the two components.</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">stream_rhos</span> <span class="o">*</span> <span class="n">ratio</span>

        <span class="k">return</span> <span class="n">factors</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_stream_discount_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discounting_type</span><span class="p">,</span> <span class="n">fair_aggregation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stream of discount factors</span>
<span class="sd">        Returns specified Ramsey or Weitzman-Ramsey discount factors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        discounting_type : str</span>
<span class="sd">            Type of discounting to implement. Typically,</span>
<span class="sd">            self.discounting_type is passed. However, for local Euler rates,</span>
<span class="sd">            this changes depending on the option.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `xarray.DataArray`</span>
<span class="sd">            Discount rates indexed by year and (if Ramsey) SSP/model</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># holding population constant</span>
        <span class="c1"># from 2100 to 2300 with 2099 values</span>
        <span class="n">full_pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
        <span class="n">full_pop</span> <span class="o">=</span> <span class="n">full_pop</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
            <span class="n">year</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">full_pop</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># for aggregations other than uncollapsed,</span>
        <span class="c1"># we need to collapse over pop dimensions</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="n">full_pop</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_pop</span><span class="o">.</span><span class="n">dims</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pop</span> <span class="o">=</span> <span class="n">full_pop</span>

        <span class="c1"># for gwr_gwr, we need to calculate regular naive_ramsey rates, get</span>
        <span class="c1"># discount factors, and then average them at the end</span>
        <span class="k">if</span> <span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;gwr_gwr&quot;</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_per_capita</span><span class="p">(</span><span class="s2">&quot;naive_ramsey&quot;</span><span class="p">)</span>

            <span class="c1"># average discount factors and expand dims to match Euler</span>
            <span class="n">discount_factors</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
                <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">fair_aggregation</span><span class="p">})</span>
            <span class="p">)</span>

        <span class="c1"># naive options are calculated from the no-climate-change consumption growth rate</span>
        <span class="k">elif</span> <span class="s2">&quot;naive&quot;</span> <span class="ow">in</span> <span class="n">discounting_type</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_per_capita</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">)</span>

            <span class="c1"># expand dims to match Euler</span>
            <span class="n">discount_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">fair_aggregation</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="s2">&quot;euler&quot;</span> <span class="ow">in</span> <span class="n">discounting_type</span><span class="p">:</span>
            <span class="n">discount_factors</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fair_aggregation</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;median&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;ce&quot;</span><span class="p">:</span>
                    <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ce_fair_no_pulse</span> <span class="o">/</span> <span class="n">pop</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
                    <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">/</span> <span class="n">pop</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;gwr_mean&quot;</span><span class="p">:</span>
                    <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">/</span> <span class="n">full_pop</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;median_params&quot;</span><span class="p">:</span>
                    <span class="n">median_params_damages</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_median_params_control</span><span class="p">,</span>
                        <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
                        <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">median_params_consumption</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span> <span class="o">-</span> <span class="n">median_params_damages</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">median_params_consumption</span> <span class="o">=</span> <span class="n">median_params_consumption</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">i</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span>
                                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">median_params_consumption</span><span class="o">.</span><span class="n">dims</span>
                            <span class="p">]</span>
                        <span class="p">)</span>

                    <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                        <span class="n">median_params_consumption</span> <span class="o">/</span> <span class="n">pop</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;uncollapsed&quot;</span><span class="p">:</span>
                    <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">/</span> <span class="n">full_pop</span>
                    <span class="p">)</span>

                <span class="n">factors</span> <span class="o">=</span> <span class="n">factors</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">agg</span><span class="p">})</span>
                <span class="n">discount_factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>

            <span class="n">discount_factors</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">discount_factors</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">discount_factors</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="s2">&quot;discount_factors&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">stream_discount_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_stream_discount_factors</span><span class="p">(</span>
            <span class="n">discounting_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">,</span>
            <span class="n">fair_aggregation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="s2">&quot;uncollapsed_discount_factors&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncollapsed_discount_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
            <span class="n">year</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">/</span> <span class="n">pop</span>
        <span class="p">)</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;discount_factor&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">f</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">encoding</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">f</span>

    <span class="nd">@cachedproperty</span>
    <span class="nd">@save</span><span class="p">(</span><span class="s2">&quot;uncollapsed_marginal_damages&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">uncollapsed_marginal_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">md</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_pulse</span><span class="p">)</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">conversion</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;marginal_damages&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="n">md</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">encoding</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">md</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rechunk data appropriately and apply the certainty equivalence</span>
<span class="sd">        calculation. This is done in a loop to avoid memory crashes.</span>
<span class="sd">        Not that data MUST be chunked, otherwise Dask will take a CE over each</span>
<span class="sd">        chunk and sum the result.</span>

<span class="sd">        *** IMPORTANT NOTE ***</span>
<span class="sd">        This wrapper function CANNOT execute with weights as it uses a map_blocks</span>
<span class="sd">        function which is unable to determine how to match weight dimensions with</span>
<span class="sd">        its chunk. If you must weight, `c_equivalence` function must be used directly</span>
<span class="sd">        on the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="n">dim</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">dim</span><span class="p">])})</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">c_equivalence</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.ce_cc" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.ce_cc</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ce_cc</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Certainty equivalent of consumption with climate change damages</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.ce_fair_no_pulse" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.ce_fair_no_pulse</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ce_fair_no_pulse</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Certainty equivalent of global consumption under FAIR control scenario</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.ce_fair_pulse" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.ce_fair_pulse</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ce_fair_pulse</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Certainty equivalent of global consumption under FAIR pulse scenario</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.ce_no_cc" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.ce_no_cc</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ce_no_cc</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Certainty equivalent of consumption without climate change damages</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.damage_function_coefficients" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.damage_function_coefficients</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">damage_function_coefficients</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load damage function coefficients if the coefficients are provided by the user.
Otherwise, compute them.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.damage_function_fit" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.damage_function_fit</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">damage_function_fit</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load fitted damage function if the fit is provided by the user.
Otherwise, compute them.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.gmsl_max" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.gmsl_max</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">gmsl_max</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This function finds the GMSL value at which the damage function
reaches its local maximum along the GMSL dimension.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xarray.DataArray">DataArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the array of GMSL values at which the local maximum is located, for all
years, ssps, models, and if applicable, values of GMST</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.median_params_marginal_damages" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.median_params_marginal_damages</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">median_params_marginal_damages</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate marginal damages due to a pulse using a FAIR simulation
calculated with the median climate parameters.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="dscim.menu.main_recipe.MainRecipe.output_attrs" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dscim.menu.main_recipe.MainRecipe.output_attrs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">output_attrs</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return dict with class attributes for output metadata</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    A dict Class metadata</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.calculate_discount_factors" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.calculate_discount_factors</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_discount_factors</span><span class="p">(</span><span class="n">cons_pc</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculates the stream of discount factors based on the Euler equation that defines an optimal
intertemporal consumption allocation. Rearranging that equation shows that an outcome that will occur at the
period t will be converted into today's, period 0 value, the following way :</p>
<p>Discrete discounting: discount_factor_t = [ 1/(1+rho)^t ] * [ U'(C(t)) / U'(C(0)) ]</p>
<p>where rho is the pure rate of time preference, U() is the utility function, U'() the first derivative,
C(0) and C(t) today's and the future consumption respectively. The higher rho, the higher the importance
of the present relative to the future so the lower the discount factor, and, if the utility function is concave,
the higher the growth of consumption, the lower the importance of the future consumption relative to today, and
therefore again the lower the discount factor.</p>
<p>Using a CRRA utility function and plugging the first derivative :</p>
<p>discount_factor_t = [ 1/(1+rho)^t ] * [ C(0)^eta / C(t)^eta ]</p>
<p>eta represents the degree of concavity of the utility function.</p>
<p>With continuous discounting,
discount_factor_t = Product_1^t [e^-(rho + eta * g),
    where g = ln(C(t)/C(t-1))</p>
<p>rearranging yields rho_continuous = e^rho_discrete - 1</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cons_pc</code>
            </td>
            <td>
                  <code><span title="array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of per capita consumption from pulse year to end of time period.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>`xarray.DataArray` with discount factors computed following the last equation in the above description.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_discount_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cons_pc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the stream of discount factors based on the Euler equation that defines an optimal</span>
<span class="sd">    intertemporal consumption allocation. Rearranging that equation shows that an outcome that will occur at the</span>
<span class="sd">    period t will be converted into today&#39;s, period 0 value, the following way :</span>

<span class="sd">    Discrete discounting: discount_factor_t = [ 1/(1+rho)^t ] * [ U&#39;(C(t)) / U&#39;(C(0)) ]</span>

<span class="sd">    where rho is the pure rate of time preference, U() is the utility function, U&#39;() the first derivative,</span>
<span class="sd">    C(0) and C(t) today&#39;s and the future consumption respectively. The higher rho, the higher the importance</span>
<span class="sd">    of the present relative to the future so the lower the discount factor, and, if the utility function is concave,</span>
<span class="sd">    the higher the growth of consumption, the lower the importance of the future consumption relative to today, and</span>
<span class="sd">    therefore again the lower the discount factor.</span>

<span class="sd">    Using a CRRA utility function and plugging the first derivative :</span>

<span class="sd">    discount_factor_t = [ 1/(1+rho)^t ] * [ C(0)^eta / C(t)^eta ]</span>

<span class="sd">    eta represents the degree of concavity of the utility function.</span>

<span class="sd">    With continuous discounting,</span>
<span class="sd">    discount_factor_t = Product_1^t [e^-(rho + eta * g),</span>
<span class="sd">        where g = ln(C(t)/C(t-1))</span>

<span class="sd">    rearranging yields rho_continuous = e^rho_discrete - 1</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cons_pc : array</span>
<span class="sd">        Array of per capita consumption from pulse year to end of time period.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `xarray.DataArray` with discount factors computed following the last equation in the above description.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># subset to pulse year onward</span>
    <span class="n">cons_pc</span> <span class="o">=</span> <span class="n">cons_pc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span><span class="p">))</span>

    <span class="c1"># calculate the time preference component of the discount factors for each period.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete_discounting</span><span class="p">:</span>
        <span class="c1"># plug the unique rho in an array</span>
        <span class="n">rhos</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">cons_pc</span><span class="o">.</span><span class="n">year</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># plug the unique rho in an array, and compute e^rho - 1</span>
        <span class="n">rhos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rho</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">cons_pc</span><span class="o">.</span><span class="n">year</span><span class="p">]))</span>

    <span class="n">stream_rhos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span>
        <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">accumulate</span><span class="p">((</span><span class="n">rhos</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rhos</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="c1"># calculate the marginal utility component of the discount factors for each period.</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="n">cons_pc</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">/</span> <span class="n">cons_pc</span> <span class="o">**</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span>
    <span class="p">)</span>

    <span class="c1"># the discount factor is the product of the two components.</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="n">stream_rhos</span> <span class="o">*</span> <span class="n">ratio</span>

    <span class="k">return</span> <span class="n">factors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.calculate_scc" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.calculate_scc</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_scc</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate range of FAIR-aggregated SCCs</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;scc&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_scc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate range of FAIR-aggregated SCCs&quot;&quot;&quot;</span>

    <span class="n">discounted_damages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounted_damages</span><span class="p">(</span>
        <span class="n">damages</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">marginal_damages</span><span class="p">,</span> <span class="n">discrate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span>
    <span class="p">)</span>
    <span class="n">discounted_damages</span> <span class="o">=</span> <span class="n">discounted_damages</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;scc&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;median&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_sccs</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>
        <span class="n">median</span><span class="p">[</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;median&quot;</span><span class="p">]</span>
        <span class="n">discounted_damages</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">median</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;scc&quot;</span><span class="p">),</span> <span class="n">discounted_damages</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">discounted_damages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.calculate_stream_discount_factors" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.calculate_stream_discount_factors</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_stream_discount_factors</span><span class="p">(</span><span class="n">discounting_type</span><span class="p">,</span> <span class="n">fair_aggregation</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Stream of discount factors
Returns specified Ramsey or Weitzman-Ramsey discount factors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>discounting_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of discounting to implement. Typically,
self.discounting_type is passed. However, for local Euler rates,
this changes depending on the option.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>`xarray.DataArray`</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Discount rates indexed by year and (if Ramsey) SSP/model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_stream_discount_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">discounting_type</span><span class="p">,</span> <span class="n">fair_aggregation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stream of discount factors</span>
<span class="sd">    Returns specified Ramsey or Weitzman-Ramsey discount factors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    discounting_type : str</span>
<span class="sd">        Type of discounting to implement. Typically,</span>
<span class="sd">        self.discounting_type is passed. However, for local Euler rates,</span>
<span class="sd">        this changes depending on the option.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `xarray.DataArray`</span>
<span class="sd">        Discount rates indexed by year and (if Ramsey) SSP/model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># holding population constant</span>
    <span class="c1"># from 2100 to 2300 with 2099 values</span>
    <span class="n">full_pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
    <span class="n">full_pop</span> <span class="o">=</span> <span class="n">full_pop</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
        <span class="n">year</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">full_pop</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># for aggregations other than uncollapsed,</span>
    <span class="c1"># we need to collapse over pop dimensions</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">full_pop</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_pop</span><span class="o">.</span><span class="n">dims</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">full_pop</span>

    <span class="c1"># for gwr_gwr, we need to calculate regular naive_ramsey rates, get</span>
    <span class="c1"># discount factors, and then average them at the end</span>
    <span class="k">if</span> <span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;gwr_gwr&quot;</span><span class="p">:</span>
        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_per_capita</span><span class="p">(</span><span class="s2">&quot;naive_ramsey&quot;</span><span class="p">)</span>

        <span class="c1"># average discount factors and expand dims to match Euler</span>
        <span class="n">discount_factors</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
            <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">fair_aggregation</span><span class="p">})</span>
        <span class="p">)</span>

    <span class="c1"># naive options are calculated from the no-climate-change consumption growth rate</span>
    <span class="k">elif</span> <span class="s2">&quot;naive&quot;</span> <span class="ow">in</span> <span class="n">discounting_type</span><span class="p">:</span>
        <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_per_capita</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">)</span>

        <span class="c1"># expand dims to match Euler</span>
        <span class="n">discount_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">fair_aggregation</span><span class="p">}</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="s2">&quot;euler&quot;</span> <span class="ow">in</span> <span class="n">discounting_type</span><span class="p">:</span>
        <span class="n">discount_factors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fair_aggregation</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;median&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;ce&quot;</span><span class="p">:</span>
                <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ce_fair_no_pulse</span> <span class="o">/</span> <span class="n">pop</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
                <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">/</span> <span class="n">pop</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;gwr_mean&quot;</span><span class="p">:</span>
                <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">/</span> <span class="n">full_pop</span>
                <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;median_params&quot;</span><span class="p">:</span>
                <span class="n">median_params_damages</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_median_params_control</span><span class="p">,</span>
                    <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
                    <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">median_params_consumption</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span> <span class="o">-</span> <span class="n">median_params_damages</span>
                <span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">median_params_consumption</span> <span class="o">=</span> <span class="n">median_params_consumption</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">i</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">median_params_consumption</span><span class="o">.</span><span class="n">dims</span>
                        <span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                    <span class="n">median_params_consumption</span> <span class="o">/</span> <span class="n">pop</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;uncollapsed&quot;</span><span class="p">:</span>
                <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_discount_factors</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">/</span> <span class="n">full_pop</span>
                <span class="p">)</span>

            <span class="n">factors</span> <span class="o">=</span> <span class="n">factors</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">agg</span><span class="p">})</span>
            <span class="n">discount_factors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">factors</span><span class="p">)</span>

        <span class="n">discount_factors</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">discount_factors</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">discount_factors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.calculated_damages" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.calculated_damages</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculated_damages</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate damages (difference between CEs) for collapsing</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculated_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate damages (difference between CEs) for collapsing&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.ce" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.ce</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ce</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Rechunk data appropriately and apply the certainty equivalence
calculation. This is done in a loop to avoid memory crashes.
Not that data MUST be chunked, otherwise Dask will take a CE over each
chunk and sum the result.</p>
<p>*** IMPORTANT NOTE ***
This wrapper function CANNOT execute with weights as it uses a map_blocks
function which is unable to determine how to match weight dimensions with
its chunk. If you must weight, <code>c_equivalence</code> function must be used directly
on the data.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">dims</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rechunk data appropriately and apply the certainty equivalence</span>
<span class="sd">    calculation. This is done in a loop to avoid memory crashes.</span>
<span class="sd">    Not that data MUST be chunked, otherwise Dask will take a CE over each</span>
<span class="sd">    chunk and sum the result.</span>

<span class="sd">    *** IMPORTANT NOTE ***</span>
<span class="sd">    This wrapper function CANNOT execute with weights as it uses a map_blocks</span>
<span class="sd">    function which is unable to determine how to match weight dimensions with</span>
<span class="sd">    its chunk. If you must weight, `c_equivalence` function must be used directly</span>
<span class="sd">    on the data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="n">dim</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="n">dim</span><span class="p">])})</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">c_equivalence</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="n">dim</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.ce_cc_calculation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.ce_cc_calculation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ce_cc_calculation</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate CE damages depending on discount type</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ce_cc_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate CE damages depending on discount type&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.ce_no_cc_calculation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.ce_no_cc_calculation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ce_no_cc_calculation</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate GDP CE depending on discount type.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ce_no_cc_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate GDP CE depending on discount type.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.collapsed_pop" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.collapsed_pop</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">collapsed_pop</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Collapse population according to discount type.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="k">def</span><span class="w"> </span><span class="nf">collapsed_pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collapse population according to discount type.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;ramsey&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">):</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">:</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s2">&quot;gwr&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">:</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;ssp&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">pop</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.damage_function" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.damage_function</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">damage_function</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calls damage function calculation method.</p>
<p>This function calls the damage function calculation in
model_outputs(). It calculates a damage function for each
passed <code>scenario_dimension</code> based on subsets of
self.damage_function_points and extrapolates this function
using the specified method for all years post-end_ext_subset_year.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict['params'] is a dataframe of betas for each year
dict['preds'] is a dataframe of predicted y hat for each
    year and anomaly</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="k">def</span><span class="w"> </span><span class="nf">damage_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls damage function calculation method.</span>

<span class="sd">    This function calls the damage function calculation in</span>
<span class="sd">    model_outputs(). It calculates a damage function for each</span>
<span class="sd">    passed `scenario_dimension` based on subsets of</span>
<span class="sd">    self.damage_function_points and extrapolates this function</span>
<span class="sd">    using the specified method for all years post-end_ext_subset_year.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        dict[&#39;params&#39;] is a dataframe of betas for each year</span>
<span class="sd">        dict[&#39;preds&#39;] is a dataframe of predicted y hat for each</span>
<span class="sd">            year and anomaly</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># this only occurs for global discounting</span>
        <span class="c1"># with a single scenario passed</span>
        <span class="n">damage_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_calculation</span><span class="p">(</span>
            <span class="n">damage_function_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_points</span><span class="p">,</span>
            <span class="n">global_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># cycle through the different combinations of the scenario dims</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_points</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span><span class="p">)</span>
        <span class="n">damage_function</span><span class="p">,</span> <span class="n">dict_list</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
            <span class="c1"># turn single-dim into a tuple to make indexing easier later</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">name</span><span class="p">])</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_calculation</span><span class="p">(</span>
                <span class="n">damage_function_points</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                <span class="n">global_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># assigning dimensions to each dataArray in the dictionary</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="n">var</span><span class="p">:</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario_dimensions</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># concatenate different scenarios into one big dataArray</span>
        <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dict_list</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">damage_function</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.damage_function_calculation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.damage_function_calculation</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">damage_function_calculation</span><span class="p">(</span><span class="n">damage_function_points</span><span class="p">,</span> <span class="n">global_consumption</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>The damage function model fit may be : (1) ssp specific, (2) ssp-model specific, (3) unique across ssp-model.
This depends on the type of discounting. In each case the input data passed to the fitting functions and the formatting of the returned
output is different because dimensions are different. This function handles this and returns the model fit.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict with two xr.Datasets, &#39;params&#39; (model fit) and &#39;preds&#39; (predictions from model fit), with dimensions depending</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code>on self.discounting_type.</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">damage_function_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">damage_function_points</span><span class="p">,</span> <span class="n">global_consumption</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The damage function model fit may be : (1) ssp specific, (2) ssp-model specific, (3) unique across ssp-model.</span>
<span class="sd">    This depends on the type of discounting. In each case the input data passed to the fitting functions and the formatting of the returned</span>
<span class="sd">    output is different because dimensions are different. This function handles this and returns the model fit.</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">    dict with two xr.Datasets, &#39;params&#39; (model fit) and &#39;preds&#39; (predictions from model fit), with dimensions depending</span>
<span class="sd">    on self.discounting_type.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">yrs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">params_list</span><span class="p">,</span> <span class="n">preds_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ssp</span> <span class="ow">in</span> <span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="c1"># Subset dataframe to specific SSP</span>
            <span class="n">fit_subset</span> <span class="o">=</span> <span class="n">damage_function_points</span><span class="p">[</span>
                <span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ssp</span>
            <span class="p">]</span>

            <span class="n">global_c_subset</span> <span class="o">=</span> <span class="n">global_consumption</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s2">&quot;ssp&quot;</span><span class="p">:</span> <span class="n">ssp</span><span class="p">})</span>
            <span class="c1"># Fit damage function curves using the data subset</span>
            <span class="n">damage_function</span> <span class="o">=</span> <span class="n">model_outputs</span><span class="p">(</span>
                <span class="n">damage_function</span><span class="o">=</span><span class="n">fit_subset</span><span class="p">,</span>
                <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                <span class="n">type_estimation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span><span class="p">,</span>
                <span class="n">global_c</span><span class="o">=</span><span class="n">global_c_subset</span><span class="p">,</span>
                <span class="n">extrapolation_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span><span class="p">,</span>
                <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">,</span>
                <span class="n">year_range</span><span class="o">=</span><span class="n">yrs</span><span class="p">,</span>
                <span class="n">year_start_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Add variables</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                    <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span>
                    <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">preds</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                    <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span>
                    <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">preds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span> <span class="o">==</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="s2">&quot;ramsey&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">ssp</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">product</span><span class="p">(</span>
                <span class="n">damage_function_points</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
                <span class="n">damage_function_points</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># Subset dataframe to specific SSP-IAM combination.</span>
            <span class="n">fit_subset</span> <span class="o">=</span> <span class="n">damage_function_points</span><span class="p">[</span>
                <span class="p">(</span><span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;ssp&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ssp</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="n">damage_function_points</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">model</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">global_c_subset</span> <span class="o">=</span> <span class="n">global_consumption</span><span class="o">.</span><span class="n">sel</span><span class="p">({</span><span class="s2">&quot;ssp&quot;</span><span class="p">:</span> <span class="n">ssp</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">})</span>

            <span class="c1"># Fit damage function curves using the data subset</span>
            <span class="n">damage_function</span> <span class="o">=</span> <span class="n">model_outputs</span><span class="p">(</span>
                <span class="n">damage_function</span><span class="o">=</span><span class="n">fit_subset</span><span class="p">,</span>
                <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
                <span class="n">type_estimation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span><span class="p">,</span>
                <span class="n">global_c</span><span class="o">=</span><span class="n">global_c_subset</span><span class="p">,</span>
                <span class="n">extrapolation_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span><span class="p">,</span>
                <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">,</span>
                <span class="n">year_range</span><span class="o">=</span><span class="n">yrs</span><span class="p">,</span>
                <span class="n">year_start_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Add variables</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span> <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">preds</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span> <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="n">ssp</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="n">preds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

    <span class="k">elif</span> <span class="s2">&quot;gwr&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">:</span>
        <span class="c1"># Fit damage function across all SSP-IAM combinations, as expected</span>
        <span class="c1"># from the Weitzman-Ramsey discounting</span>
        <span class="n">fit_subset</span> <span class="o">=</span> <span class="n">damage_function_points</span>

        <span class="c1"># Fit damage function curves using the data subset</span>
        <span class="n">damage_function</span> <span class="o">=</span> <span class="n">model_outputs</span><span class="p">(</span>
            <span class="n">damage_function</span><span class="o">=</span><span class="n">fit_subset</span><span class="p">,</span>
            <span class="n">type_estimation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span><span class="p">,</span>
            <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
            <span class="n">global_c</span><span class="o">=</span><span class="n">global_consumption</span><span class="p">,</span>
            <span class="n">extrapolation_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_method</span><span class="p">,</span>
            <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantreg_quantiles</span><span class="p">,</span>
            <span class="n">year_range</span><span class="o">=</span><span class="n">yrs</span><span class="p">,</span>
            <span class="n">year_start_pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add variables</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">preds</span> <span class="o">=</span> <span class="n">damage_function</span><span class="p">[</span><span class="s2">&quot;preds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">discount_type</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">],</span>
                <span class="n">ssp</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
                <span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">values</span><span class="p">))],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">params_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">preds_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">params</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span><span class="n">params_list</span><span class="p">),</span>
        <span class="n">preds</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span><span class="n">preds_list</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.damage_function_points" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.damage_function_points</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">damage_function_points</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Global damages by RCP/GCM or SLR</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    pd.DataFrame</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;damage_function_points&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">damage_function_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global damages by RCP/GCM or SLR</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_damages_calculation</span><span class="p">()</span>

    <span class="k">if</span> <span class="s2">&quot;slr&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">gmsl</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;slr&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;gcm&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">gmst</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;gcm&quot;</span><span class="p">,</span> <span class="s2">&quot;rcp&quot;</span><span class="p">])</span>

    <span class="c1"># removing illegal combinations from estimation</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">ssp</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;SSP1&quot;</span><span class="p">,</span> <span class="s2">&quot;SSP5&quot;</span><span class="p">]]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropping illegal model combinations.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;anomaly&quot;</span><span class="p">,</span> <span class="s2">&quot;gmsl&quot;</span><span class="p">]]:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">ssp</span> <span class="o">==</span> <span class="s2">&quot;SSP1&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rcp</span> <span class="o">==</span> <span class="s2">&quot;rcp85&quot;</span><span class="p">))</span>
                <span class="o">|</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">ssp</span> <span class="o">==</span> <span class="s2">&quot;SSP5&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rcp</span> <span class="o">==</span> <span class="s2">&quot;rcp45&quot;</span><span class="p">)),</span>
                <span class="n">var</span><span class="p">,</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># agriculture lacks ACCESS0-1/rcp85 combo</span>
    <span class="k">if</span> <span class="s2">&quot;agriculture&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sector</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dropping illegal model combinations for agriculture.&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">gcm</span> <span class="o">==</span> <span class="s2">&quot;ACCESS1-0&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">rcp</span> <span class="o">==</span> <span class="s2">&quot;rcp85&quot;</span><span class="p">),</span> <span class="s2">&quot;anomaly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.discounted_damages" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.discounted_damages</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">discounted_damages</span><span class="p">(</span><span class="n">damages</span><span class="p">,</span> <span class="n">discrate</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Discount marginal damages. Distinguishes between constant discount rates method and non-constant discount rates.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>damages</code>
            </td>
            <td>
                  <code><span title="xarray.DataArray">DataArray</span> or <span title="xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of damages with a<code>discount_type</code> dimension to subset the damages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>discrate</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Discounting type. Be aware that the constant rates are class-wide defined. If this str is either 'constant' or 'constant_model_collapsed', the predetermined constant discount rates are used, otherwise, the stream of (non-constant) discount factors from self.stream_discount_factors() is used.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    xr.Dataset</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discounted_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">damages</span><span class="p">,</span> <span class="n">discrate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Discount marginal damages. Distinguishes between constant discount rates method and non-constant discount rates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    damages : xr.DataArray or xr.Dataset</span>
<span class="sd">        Array of damages with a`discount_type` dimension to subset the damages.</span>
<span class="sd">    discrate : str</span>
<span class="sd">         Discounting type. Be aware that the constant rates are class-wide defined. If this str is either &#39;constant&#39; or &#39;constant_model_collapsed&#39;, the predetermined constant discount rates are used, otherwise, the stream of (non-constant) discount factors from self.stream_discount_factors() is used.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        xr.Dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">discrate</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="s2">&quot;constant_model_collapsed&quot;</span><span class="p">,</span> <span class="s2">&quot;constant_gwr&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete_discounting</span><span class="p">:</span>
            <span class="n">discrate_damages</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">damages</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="n">damages</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONST_DISC_RATES</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">discrate_damages</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">damages</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">damages</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">pulse_year</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONST_DISC_RATES</span>
            <span class="p">]</span>

        <span class="n">pvd_damages</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="n">discrate_damages</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CONST_DISC_RATES</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;discrate&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_stream_discount_factors</span><span class="p">(</span>
            <span class="n">discounting_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">,</span>
            <span class="n">fair_aggregation</span><span class="o">=</span><span class="n">damages</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pvd_damages</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">*</span> <span class="n">damages</span>

    <span class="k">return</span> <span class="n">pvd_damages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.full_uncertainty_iqr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.full_uncertainty_iqr</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">full_uncertainty_iqr</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the distribution of quantile-weighted SCCs produced from
quantile regressions.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;full_uncertainty_iqr&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">full_uncertainty_iqr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the distribution of quantile-weighted SCCs produced from</span>
<span class="sd">    quantile regressions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">quantile_weight_quantilereg</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_sccs</span><span class="p">,</span>
        <span class="n">fair_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">,</span>
        <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_quantiles</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.global_consumption" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.global_consumption</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">global_consumption</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Global consumption without climate change</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_consumption&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">global_consumption</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global consumption without climate change&quot;&quot;&quot;</span>

    <span class="c1"># rff simulation means that GDP already exists out to 2300</span>
    <span class="k">if</span> <span class="mi">2300</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Global consumption found up to 2300.&quot;</span><span class="p">)</span>
        <span class="n">global_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;global_consumption&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extrapolating global consumption.&quot;</span><span class="p">)</span>

        <span class="c1"># holding population constant</span>
        <span class="c1"># from 2100 to 2300 with 2099 values</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">pop</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
            <span class="n">year</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Calculate global consumption back by</span>
        <span class="n">global_cons</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_per_capita</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">)</span> <span class="o">*</span> <span class="n">pop</span>
        <span class="p">)</span>

    <span class="c1"># Add dimension</span>
    <span class="c1"># @TODO: remove this line altogether</span>
    <span class="n">global_cons</span> <span class="o">=</span> <span class="n">global_cons</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;discount_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">]}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">global_cons</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.global_consumption_calculation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.global_consumption_calculation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">global_consumption_calculation</span><span class="p">(</span><span class="n">disc_type</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculation of global consumption without climate change</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    xr.DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculation of global consumption without climate change</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        xr.DataArray</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.global_consumption_no_pulse" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.global_consumption_no_pulse</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">global_consumption_no_pulse</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Global consumption under FAIR control scenario.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_consumption_no_pulse&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_no_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global consumption under FAIR control scenario.&quot;&quot;&quot;</span>

    <span class="n">fair_control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_control</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span><span class="p">:</span>
        <span class="n">fair_control</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fair_control</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsl_max</span><span class="p">)</span>

    <span class="n">damages</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
        <span class="n">fair_control</span><span class="p">,</span>
        <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
        <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cc_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span> <span class="o">-</span> <span class="n">damages</span>

    <span class="n">gc_no_pulse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span><span class="p">:</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_min</span><span class="p">(</span>
            <span class="n">no_cc_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
            <span class="n">cc_consumption</span><span class="o">=</span><span class="n">cc_cons</span><span class="p">,</span>
            <span class="n">parameter</span><span class="o">=</span><span class="n">wp</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">wp</span><span class="p">)})</span>

        <span class="n">gc_no_pulse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gc_no_pulse</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.global_consumption_per_capita" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.global_consumption_per_capita</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">global_consumption_per_capita</span><span class="p">(</span><span class="n">disc_type</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Global consumption per capita</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    xr.DataArray</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_per_capita</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disc_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global consumption per capita</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        xr.DataArray</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Calculate global consumption per capita</span>
    <span class="n">array_pc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_calculation</span><span class="p">(</span>
        <span class="n">disc_type</span>
    <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsed_pop</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">==</span> <span class="s2">&quot;equity&quot;</span><span class="p">:</span>
        <span class="c1"># equity recipe&#39;s growth is capped to</span>
        <span class="c1"># risk aversion recipe&#39;s growth rates</span>
        <span class="n">extrapolated</span> <span class="o">=</span> <span class="n">extrapolate</span><span class="p">(</span>
            <span class="n">xr_array</span><span class="o">=</span><span class="n">array_pc</span><span class="p">,</span>
            <span class="n">start_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_start_year</span><span class="p">,</span>
            <span class="n">end_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span><span class="p">,</span>
            <span class="n">interp_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;growth_constant&quot;</span><span class="p">,</span>
            <span class="n">cap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">risk_aversion_growth_rates</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">extrapolated</span> <span class="o">=</span> <span class="n">extrapolate</span><span class="p">(</span>
            <span class="n">xr_array</span><span class="o">=</span><span class="n">array_pc</span><span class="p">,</span>
            <span class="n">start_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_start_year</span><span class="p">,</span>
            <span class="n">end_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_subset_end_year</span><span class="p">,</span>
            <span class="n">interp_year</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ext_end_year</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;growth_constant&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">complete_array</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">array_pc</span><span class="p">,</span> <span class="n">extrapolated</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">complete_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.global_consumption_pulse" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.global_consumption_pulse</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">global_consumption_pulse</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Global consumption under FAIR pulse scenario.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;global_consumption_pulse&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">global_consumption_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global consumption under FAIR pulse scenario.&quot;&quot;&quot;</span>

    <span class="n">fair_pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">fair_pulse</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip_gmsl</span><span class="p">:</span>
        <span class="n">fair_pulse</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">fair_pulse</span><span class="p">[</span><span class="s2">&quot;gmsl&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsl_max</span><span class="p">)</span>

    <span class="n">damages</span> <span class="o">=</span> <span class="n">compute_damages</span><span class="p">(</span>
        <span class="n">fair_pulse</span><span class="p">,</span>
        <span class="n">betas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span><span class="p">,</span>
        <span class="n">formula</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">cc_cons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span> <span class="o">-</span> <span class="n">damages</span>
    <span class="n">gc_no_pulse</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">wp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_parameter</span><span class="p">:</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weitzman_min</span><span class="p">(</span>
            <span class="n">no_cc_consumption</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span><span class="p">,</span>
            <span class="n">cc_consumption</span><span class="o">=</span><span class="n">cc_cons</span><span class="p">,</span>
            <span class="n">parameter</span><span class="o">=</span><span class="n">wp</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">wp</span><span class="p">)})</span>
        <span class="n">gc_no_pulse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">gc_no_pulse</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;weitzman_parameter&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.global_damages_calculation" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.global_damages_calculation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">global_damages_calculation</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate global collapsed damages for a desired discount type</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">global_damages_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate global collapsed damages for a desired discount type&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.marginal_damages" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.marginal_damages</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">marginal_damages</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Marginal damages due to additional pulse</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;marginal_damages&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">marginal_damages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Marginal damages due to additional pulse&quot;&quot;&quot;</span>

    <span class="n">marginal_damages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s2">&quot;median&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;ce&quot;</span><span class="p">:</span>
            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce_fair_no_pulse</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce_fair_pulse</span>
        <span class="k">elif</span> <span class="n">agg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;gwr_mean&quot;</span><span class="p">]:</span>
            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span>
            <span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_pulse</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">agg</span> <span class="o">==</span> <span class="s2">&quot;median_params&quot;</span><span class="p">:</span>
            <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">median_params_marginal_damages</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">agg</span><span class="si">}</span><span class="s2"> is not available. Enter list including&quot;</span>
                <span class="s1">&#39;[&quot;ce&quot;, &quot;fair&quot;, &quot;median&quot;, &quot;median_params&quot;]&#39;</span>
            <span class="p">)</span>

        <span class="n">md</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="n">agg</span><span class="p">})</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="s2">&quot;fair_aggregation&quot;</span>
        <span class="p">)</span>

        <span class="c1"># convert to the marginal damages from a single tonne</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">md</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">conversion</span>
        <span class="n">marginal_damages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">marginal_damages</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.order_plate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.order_plate</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">order_plate</span><span class="p">(</span><span class="n">course</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute menu option section and save results</p>
<p>This method is a entry point to the class and allows the user to
calculate different elements of a specific menu option. These elements
will automatically be saved in the path defined in <code>save_path</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>course</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output to be calculated. Options are:
    - <code>damage_function</code>: Return and save all damage function
      elements including damage function points, coefficients, and
      fitted values.
    - <code>scc</code>: Return Social Cost of Carbon calculation. All elements
    from <code>damage_function</code> are saved and returned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None. Saved all elements to `save_path`</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">order_plate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute menu option section and save results</span>

<span class="sd">    This method is a entry point to the class and allows the user to</span>
<span class="sd">    calculate different elements of a specific menu option. These elements</span>
<span class="sd">    will automatically be saved in the path defined in `save_path`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    course str</span>
<span class="sd">        Output to be calculated. Options are:</span>
<span class="sd">            - `damage_function`: Return and save all damage function</span>
<span class="sd">              elements including damage function points, coefficients, and</span>
<span class="sd">              fitted values.</span>
<span class="sd">            - `scc`: Return Social Cost of Carbon calculation. All elements</span>
<span class="sd">            from `damage_function` are saved and returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None. Saved all elements to `save_path`</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Executing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">damage_function</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing damage functions ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Existing damage functions not found. Damage points will be loaded.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_coefficients</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damage_function_fit</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">scc</span><span class="p">():</span>
        <span class="n">damage_function</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing SCC calculation ...&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_type</span> <span class="o">==</span> <span class="s2">&quot;quantreg&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_iqr</span>
            <span class="c1"># stat_uncertainty_iqr function expects collapsed SCCs, so a fair aggregation is required</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stat_uncertainty_iqr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_aggregation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stream_discount_factors</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_sccs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_marginal_damages</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncollapsed_discount_factors</span>

    <span class="n">course_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;damage_function&quot;</span><span class="p">:</span> <span class="n">damage_function</span><span class="p">,</span> <span class="s2">&quot;scc&quot;</span><span class="p">:</span> <span class="n">scc</span><span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">course_dict</span><span class="p">[</span><span class="n">course</span><span class="p">]()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">course</span><span class="si">}</span><span class="s2"> is not a valid option: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error detected.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.order_scc" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.order_scc</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">order_scc</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute menu option section and save results</p>
<p>This method is a wrapper to <code>order_plate</code> that calls the "scc" course,
which is the Social Cost of Carbon calculation. Elements involved in the calculation
(<code>fair</code> and <code>damage_function</code>) will automatically be saved in the path
defined in <code>save_path</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>None</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>xr.Dataset of SCCs</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">order_scc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute menu option section and save results</span>

<span class="sd">    This method is a wrapper to `order_plate` that calls the &quot;scc&quot; course,</span>
<span class="sd">    which is the Social Cost of Carbon calculation. Elements involved in the calculation</span>
<span class="sd">    (`fair` and `damage_function`) will automatically be saved in the path</span>
<span class="sd">    defined in `save_path`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.Dataset of SCCs</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Executing </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">sccds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results available: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error detected.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;rcp45&quot;</span> <span class="ow">in</span> <span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">&quot;rcp85&quot;</span> <span class="ow">in</span> <span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">):</span>
        <span class="c1"># leave the dataset alone if there are already rcp scenario names</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># rename the CMIP6 scenario names that start with &quot;ssp*&quot;</span>
        <span class="n">sccds</span> <span class="o">=</span> <span class="n">sccds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">)</span>

        <span class="n">rcpdt</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ssp126&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP2.6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ssp245&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP4.5&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ssp370&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP7.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ssp460&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP6.0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ssp585&quot;</span><span class="p">:</span> <span class="s2">&quot;RCP8.5&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">rlst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rcp</span> <span class="ow">in</span> <span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">rlst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rcpdt</span><span class="p">[</span><span class="n">rcp</span><span class="p">])</span>
        <span class="n">sccds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;rcp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rlst</span>
        <span class="n">sccds</span> <span class="o">=</span> <span class="n">sccds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">sccds</span><span class="o">.</span><span class="n">rcp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sccds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.stat_uncertainty_iqr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.stat_uncertainty_iqr</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">stat_uncertainty_iqr</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate the distribution of quantile-weighted SCCs produced from
quantile regressions that have already been collapsed across other dimensions to give statistical-only uncertainty.</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;stat_uncertainty_iqr&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">stat_uncertainty_iqr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the distribution of quantile-weighted SCCs produced from</span>
<span class="sd">    quantile regressions that have already been collapsed across other dimensions to give statistical-only uncertainty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">quantile_weight_quantilereg</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_scc</span><span class="p">,</span>
        <span class="n">fair_dims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fair_dims</span><span class="p">,</span>
        <span class="n">quantiles</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">full_uncertainty_quantiles</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.uncollapsed_sccs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.uncollapsed_sccs</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">uncollapsed_sccs</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate full distribution of SCCs without FAIR aggregation</p>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@cachedproperty</span>
<span class="nd">@save</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;uncollapsed_sccs&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">uncollapsed_sccs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate full distribution of SCCs without FAIR aggregation&quot;&quot;&quot;</span>

    <span class="n">md</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_no_pulse</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_consumption_pulse</span>
    <span class="p">)</span>  <span class="c1"># this is for full uncertainty</span>

    <span class="c1"># convert to the marginal damages from a single pulse</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">md</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">climate</span><span class="o">.</span><span class="n">conversion</span>

    <span class="n">md</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">({</span><span class="s2">&quot;fair_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;uncollapsed&quot;</span><span class="p">]})</span>

    <span class="n">sccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discounted_damages</span><span class="p">(</span>
        <span class="n">damages</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
        <span class="n">discrate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discounting_type</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">sccs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="dscim.menu.main_recipe.MainRecipe.weitzman_min" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dscim.menu.main_recipe.MainRecipe.weitzman_min</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">weitzman_min</span><span class="p">(</span><span class="n">no_cc_consumption</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">parameter</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Implements bottom coding that fixes marginal utility below a threshold
to the marginal utility at that threshold. The threshold is the Weitzman
parameter.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>no_cc_consumption</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Consumption array of which the share will be used to calculate
the absolute Weitzman parameter, only if parameter &lt;= 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>consumption</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Consumption array to be bottom-coded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parameter</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A positive number representing the Weitzman parameter, below which marginal utility will be
top coded; ie., 0.01 implies marginal utility is top coded to the
value of marginal utility at 1% of no-climate change global consumption.
If parameter &gt; 1, it is assumed to be an absolute value.
If parameter &lt;= 1, it is assumed to be a share of future global consumption
(without climate change).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>    xr.Dataset</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/dscim/menu/main_recipe.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">weitzman_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_cc_consumption</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">parameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements bottom coding that fixes marginal utility below a threshold</span>
<span class="sd">    to the marginal utility at that threshold. The threshold is the Weitzman</span>
<span class="sd">    parameter.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    no_cc_consumption: xr.DataArray</span>
<span class="sd">        Consumption array of which the share will be used to calculate</span>
<span class="sd">        the absolute Weitzman parameter, only if parameter &lt;= 1.</span>
<span class="sd">    consumption: xr.DataArray</span>
<span class="sd">        Consumption array to be bottom-coded.</span>
<span class="sd">    parameter: float</span>
<span class="sd">        A positive number representing the Weitzman parameter, below which marginal utility will be</span>
<span class="sd">        top coded; ie., 0.01 implies marginal utility is top coded to the</span>
<span class="sd">        value of marginal utility at 1% of no-climate change global consumption.</span>
<span class="sd">        If parameter &gt; 1, it is assumed to be an absolute value.</span>
<span class="sd">        If parameter &lt;= 1, it is assumed to be a share of future global consumption</span>
<span class="sd">        (without climate change).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        xr.Dataset</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if parameter is share of consumption,</span>
    <span class="c1"># multiply by no-climate-change consumption</span>
    <span class="k">if</span> <span class="n">parameter</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameter</span> <span class="o">*</span> <span class="n">no_cc_consumption</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">w_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">parameter</span><span class="p">)</span>
        <span class="n">bottom_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">parameter</span> <span class="o">-</span> <span class="n">cc_consumption</span><span class="p">)</span>
        <span class="n">bottom_coded_cons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">w_utility</span> <span class="o">-</span> <span class="n">bottom_utility</span><span class="p">)</span>

        <span class="n">clipped_cons</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">cc_consumption</span> <span class="o">&gt;</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">bottom_coded_cons</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span>
        <span class="n">bottom_utility</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">parameter</span> <span class="o">-</span> <span class="n">cc_consumption</span>
        <span class="p">)</span>
        <span class="n">bottom_coded_cons</span> <span class="o">=</span> <span class="n">power</span><span class="p">(</span>
            <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">w_utility</span> <span class="o">-</span> <span class="n">bottom_utility</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">clipped_cons</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">cc_consumption</span> <span class="o">&gt;</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">cc_consumption</span><span class="p">,</span> <span class="n">bottom_coded_cons</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">clipped_cons</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>